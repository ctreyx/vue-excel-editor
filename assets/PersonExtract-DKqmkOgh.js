import{d as W,r as C,c as O,o as Z,a as q,b as a,e as o,f as w,g as B,t as m,F as k,h as y,_ as M,i,w as G,j as K}from"./index-T5p-aoKh.js";const Q={class:"person-extract-page"},Y={class:"upload-row"},tt={class:"uploader"},et={key:0},nt={style:{"margin-bottom":"8px"}},ot={class:"detected-columns"},st={key:1,class:"source-preview"},lt={class:"table-scroll"},at={class:"preview-table"},it={class:"uploader"},ut={key:0},rt={key:0,class:"mapping",style:{"margin-top":"10px"}},ct={class:"mapping-table"},dt={class:"multi-select-container"},vt=["onClick"],ft={key:0,class:"placeholder"},pt=["onClick"],_t={key:0,class:"dropdown-menu"},mt=["onClick"],ht=["checked"],gt={class:"actions"},bt=["disabled"],wt=["disabled"],kt=["disabled"],yt=["disabled"],xt={key:1,class:"output"},St={rows:"12",style:{width:"98%"}},Et=W({__name:"PersonExtract",setup(Ct){const u=C(null),r=C(null),v=C({}),h=C([]),x=C(null),P=O(()=>JSON.stringify(h.value,null,2)),g=O(()=>{if(!u.value||u.value.length===0)return[];const n=new Set;return u.value.forEach(t=>{t&&typeof t=="object"&&Object.keys(t).forEach(e=>n.add(e))}),Array.from(n)}),R=O(()=>u.value?u.value.slice(0,5):[]);function D(n){x.value&&(n.target.closest(".multi-select-container")||(x.value=null))}Z(()=>{document.addEventListener("click",D)}),q(()=>{document.removeEventListener("click",D)});function U(n){x.value=x.value===n?null:n}function J(n,t){v.value[n]||(v.value[n]=[]);const e=v.value[n].indexOf(t);e>-1?v.value[n].splice(e,1):v.value[n].push(t)}async function X(n){const t=await n.arrayBuffer(),e=await M(()=>import("./xlsx-BvJTHLik.js"),[]),s=e.read(t,{type:"array"});return{XLSX:e,wb:s}}async function V(n){const t=n.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:s,wb:l}=await X(e);let c=[];for(const f of l.SheetNames){const b=l.Sheets[f];if(!b)continue;const d=s.utils.sheet_to_json(b,{header:1});let _=-1;for(let p=0;p<Math.min(d.length,20);p++)if((d[p]||[]).map(L=>String(L).trim()).includes("姓名")){_=p;break}if(_===-1)continue;const S=(d[_]||[]).map(p=>String(p).trim()),H=d.slice(_+1).map(p=>{const E={};return S.forEach((L,F)=>{L&&(E[L]=p[F]!==void 0?p[F]:"")}),E}).filter(p=>Object.values(p).some(E=>E!==""));c=c.concat(H)}c.length===0&&alert("未在任何 Sheet 中找到包含“姓名”的表头数据"),u.value=c,r.value&&N()}async function A(n){const t=n.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:s,wb:l}=await X(e),c=l.SheetNames[0];if(!c)return;const f=l.Sheets[c];if(!f)return;const b=s.utils.sheet_to_json(f,{header:1});let d;for(const _ of b)if(_&&_.some(S=>S!=null&&String(S).trim()!=="")){d=_;break}d?(r.value=d.map(_=>String(_).trim()),u.value&&N()):r.value=[]}function j(n){return n.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").toLowerCase()}function I(n,t){const e=j(n),s={身份证号码:"身份证号",联系方式:"手机号",联系电话:"手机号",手机号:"手机号","所在部门/公司":"部门",所在部门:"部门",部门:"部门",公司:"公司",姓名:"姓名",性别:"性别",年龄:"年龄",岁数:"年龄",政治面貌:"政治面貌"};if(t.includes(n))return n;if(s[n]){const l=s[n],c=t.find(f=>f===l||f.includes(l));if(c)return c}for(const l of t)if(j(l)===e)return l;for(const l of t)if(j(l).includes(e)||e.includes(j(l)))return l;return null}function N(){if(!u.value||!r.value)return;const n=g.value,t={};for(const e of r.value){const s=I(e,n);t[e]=s?[s]:[]}v.value=t}function T(){if(h.value=[],!u.value||!r.value)return;const n=g.value.find(s=>s==="公司")||g.value.find(s=>s.includes("公司"));let t=[...u.value];n&&t.sort((s,l)=>{const c=String(s[n]||"").trim(),f=String(l[n]||"").trim();return c.localeCompare(f,"zh-CN")});const e=v.value;for(const s of t){const l={};for(const c of r.value){const f=e[c]||[];let b="";for(const d of f)if(s[d]!==void 0&&s[d]!==""&&s[d]!==null){b=s[d];break}l[c]=b}h.value.push(l)}}async function z(){if(!h.value.length)return;const n=await M(()=>import("./xlsx-BvJTHLik.js"),[]),t=n.utils.json_to_sheet(h.value,{header:r.value||[]}),e=n.utils.book_new();n.utils.book_append_sheet(e,t,"提取结果"),n.writeFile(e,"人员提取结果.xlsx")}function $(){const n=new Blob([JSON.stringify(h.value,null,2)],{type:"application/json"}),t=URL.createObjectURL(n),e=document.createElement("a");e.href=t,e.download="person-extract.json",e.click(),URL.revokeObjectURL(t)}return(n,t)=>(i(),a("div",Q,[t[7]||(t[7]=o("h1",null,"人员提取",-1)),o("div",Y,[o("div",tt,[t[1]||(t[1]=o("h3",null,"1) 上传待提取的 Excel（源表）",-1)),o("input",{type:"file",accept:".xls,.xlsx",onChange:V},null,32),u.value?(i(),a("div",et,[o("div",nt,[t[0]||(t[0]=B("总行数：",-1)),o("strong",null,m(u.value.length),1)]),o("div",ot,[o("div",null,"检测到的列："+m(g.value.join(", ")),1)])])):w("",!0),u.value&&u.value.length?(i(),a("div",st,[o("h4",null,"源表预览（前 "+m(R.value.length)+" 行）",1),o("div",lt,[o("table",at,[o("thead",null,[o("tr",null,[(i(!0),a(k,null,y(g.value,e=>(i(),a("th",{key:e},m(e),1))),128))])]),o("tbody",null,[(i(!0),a(k,null,y(R.value,(e,s)=>(i(),a("tr",{key:s},[(i(!0),a(k,null,y(g.value,l=>(i(),a("td",{key:l},m(e[l]),1))),128))]))),128))])])])])):w("",!0)]),o("div",it,[t[2]||(t[2]=o("h3",null,"2) 上传模版 Excel（模板表）",-1)),o("input",{type:"file",accept:".xls,.xlsx",onChange:A},null,32),r.value?(i(),a("div",ut," 模版字段："+m(r.value.join(", ")),1)):w("",!0)])]),r.value&&r.value.length?(i(),a("div",rt,[t[5]||(t[5]=o("h4",null,"3) 字段映射确认（支持多选，优先使用靠前的非空值）",-1)),o("table",ct,[t[4]||(t[4]=o("thead",null,[o("tr",null,[o("th",{style:{width:"30%"}},"模版字段"),o("th",null,"映射到源表列 (可多选)")])],-1)),o("tbody",null,[(i(!0),a(k,null,y(r.value,e=>(i(),a("tr",{key:e},[o("td",null,m(e),1),o("td",null,[o("div",dt,[o("div",{class:"selected-tags",onClick:s=>U(e)},[!v.value[e]||v.value[e].length===0?(i(),a("span",ft,"点击选择源列...")):w("",!0),(i(!0),a(k,null,y(v.value[e],s=>(i(),a("span",{key:s,class:"tag"},[B(m(s)+" ",1),o("span",{class:"remove-tag",onClick:G(l=>J(e,s),["stop"])},"×",8,pt)]))),128)),t[3]||(t[3]=o("span",{class:"arrow"},"▼",-1))],8,vt),x.value===e?(i(),a("div",_t,[(i(!0),a(k,null,y(g.value,s=>(i(),a("div",{class:"dropdown-item",key:s,onClick:l=>J(e,s)},[o("input",{type:"checkbox",checked:v.value[e]?.includes(s)},null,8,ht),o("span",null,m(s),1)],8,mt))),128))])):w("",!0)])])]))),128))])])])):w("",!0),o("div",gt,[o("button",{onClick:N,disabled:!u.value||!r.value},"重置自动映射",8,bt),o("button",{onClick:T,disabled:!u.value||!r.value},"生成数据并预览",8,wt),o("button",{onClick:z,disabled:!h.value.length},"下载结果 Excel",8,kt),o("button",{onClick:$,disabled:!h.value.length},"下载 JSON",8,yt)]),h.value.length?(i(),a("div",xt,[t[6]||(t[6]=o("h4",null,"输出 JSON（预览，已按公司排序）",-1)),o("textarea",St,m(P.value),1)])):w("",!0)]))}}),Nt=K(Et,[["__scopeId","data-v-49e7af94"]]);export{Nt as default};
