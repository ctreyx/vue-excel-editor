import{d as A,r as L,c as j,a as i,b as n,e as g,t as h,F as y,f as k,_ as X,o as c,w as T,v as H}from"./index-BsS872xd.js";const W={class:"person-extract-page"},Z={class:"upload-row"},q={class:"uploader"},G={key:0},K={key:1,class:"source-preview"},Q={class:"table-scroll"},Y={class:"preview-table"},$={class:"uploader"},tt={key:0},et={key:0,class:"mapping"},nt={class:"mapping-table"},ot=["onUpdate:modelValue"],st=["value"],lt={class:"actions"},at=["disabled"],rt=["disabled"],ut=["disabled"],it=["disabled"],ct={key:1,class:"output"},dt={rows:"12",style:{width:"100%"}},vt=A({__name:"PersonExtract",setup(N){const a=L(null),r=L(null),m=L({}),v=L([]),D=j(()=>JSON.stringify(v.value,null,2)),w=j(()=>!a.value||a.value.length===0?[]:Object.keys(a.value[0])),O=j(()=>a.value?a.value.slice(0,5):[]);async function R(s){const t=await s.arrayBuffer(),e=await X(()=>import("./xlsx-BvJTHLik.js"),[]),o=e.read(t,{type:"array"}),l=o.SheetNames[0];if(!l)throw alert("Excel 文件为空或无法读取"),new Error("No sheets found");const u=o.Sheets[l];if(!u)throw new Error("Sheet content is empty");return{XLSX:e,wb:o,ws:u}}async function F(s){const t=s.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:o,wb:l}=await R(e);let u=[];for(const d of l.SheetNames){const p=l.Sheets[d];if(!p)continue;const _=o.utils.sheet_to_json(p,{header:1});let x=-1;for(let f=0;f<Math.min(_.length,20);f++)if((_[f]||[]).map(E=>String(E).trim()).includes("姓名")){x=f;break}if(x===-1)continue;const M=(_[x]||[]).map(f=>String(f).trim()),z=_.slice(x+1).map(f=>{const b={};return M.forEach((E,J)=>{E&&(b[E]=f[J]!==void 0?f[J]:"")}),b}).filter(f=>Object.values(f).some(b=>b!==""));u=u.concat(z)}u.length===0&&alert("未在任何 Sheet 中找到包含“姓名”的表头数据"),a.value=u}async function B(s){const t=s.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:o,ws:l}=await R(e),u=o.utils.sheet_to_json(l,{header:1});let d;for(const p of u)if(p&&p.some(_=>_!=null&&String(_).trim()!=="")){d=p;break}d?(r.value=d.map(p=>String(p).trim()),a.value&&C()):r.value=[]}function S(s){return s.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").toLowerCase()}function P(s,t){const e=S(s),o={身份证号码:"身份证号",联系方式:"手机号",联系电话:"手机号",手机号:"手机号","所在部门/公司":"部门",所在部门:"部门",部门:"部门",公司:"公司",姓名:"姓名",性别:"性别",年龄:"年龄(岁)",政治面貌:"政治面貌"};if(t.includes(s))return s;if(o[s]){const l=o[s],u=t.find(d=>d===l||d.includes(l));if(u)return u}for(const l of t)if(S(l)===e)return l;for(const l of t)if(S(l).includes(e)||e.includes(S(l)))return l;return""}function C(){if(!a.value||!r.value)return;const s=w.value,t={};for(const e of r.value){const o=P(e,s);t[e]=o||""}m.value=t}function U(){if(v.value=[],!a.value||!r.value)return;const s=w.value.find(o=>o==="公司")||w.value.find(o=>o.includes("公司"));let t=[...a.value];s&&t.sort((o,l)=>{const u=String(o[s]||"").trim(),d=String(l[s]||"").trim();return u.localeCompare(d,"zh-CN")});const e=m.value;for(const o of t){const l={};for(const u of r.value){const d=e[u];l[u]=d?o[d]??"":""}v.value.push(l)}}async function V(){if(!v.value.length)return;const s=await X(()=>import("./xlsx-BvJTHLik.js"),[]),t=s.utils.json_to_sheet(v.value,{header:r.value||[]}),e=s.utils.book_new();s.utils.book_append_sheet(e,t,"提取结果"),s.writeFile(e,"人员提取结果.xlsx")}function I(){const s=new Blob([JSON.stringify(v.value,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),e=document.createElement("a");e.href=t,e.download="person-extract.json",e.click(),URL.revokeObjectURL(t)}return(s,t)=>(c(),i("div",W,[t[6]||(t[6]=n("h1",null,"人员提取",-1)),n("div",Z,[n("div",q,[t[0]||(t[0]=n("h3",null,"1) 上传待提取的 Excel（源表）",-1)),n("input",{type:"file",accept:".xls,.xlsx",onChange:F},null,32),a.value?(c(),i("div",G," 行数："+h(a.value.length),1)):g("",!0),a.value&&a.value.length?(c(),i("div",K,[n("h4",null,"源表预览（前 "+h(O.value.length)+" 行）",1),n("div",Q,[n("table",Y,[n("thead",null,[n("tr",null,[(c(!0),i(y,null,k(w.value,e=>(c(),i("th",{key:e},h(e),1))),128))])]),n("tbody",null,[(c(!0),i(y,null,k(O.value,(e,o)=>(c(),i("tr",{key:o},[(c(!0),i(y,null,k(w.value,l=>(c(),i("td",{key:l},h(e[l]),1))),128))]))),128))])])])])):g("",!0)]),n("div",$,[t[1]||(t[1]=n("h3",null,"2) 上传模版 Excel（模板表）",-1)),n("input",{type:"file",accept:".xls,.xlsx",onChange:B},null,32),r.value?(c(),i("div",tt," 模版字段："+h(r.value.join(", ")),1)):g("",!0)])]),r.value&&r.value.length?(c(),i("div",et,[t[4]||(t[4]=n("h4",null,"3) 字段映射确认（可手动修改）",-1)),n("table",nt,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"模版字段"),n("th",null,"映射到源表列")])],-1)),n("tbody",null,[(c(!0),i(y,null,k(r.value,e=>(c(),i("tr",{key:e},[n("td",null,h(e),1),n("td",null,[T(n("select",{"onUpdate:modelValue":o=>m.value[e]=o},[t[2]||(t[2]=n("option",{value:""},"(请选择源表列)",-1)),(c(!0),i(y,null,k(w.value,o=>(c(),i("option",{key:o,value:o},h(o),9,st))),128))],8,ot),[[H,m.value[e]]])])]))),128))])])])):g("",!0),n("div",lt,[n("button",{onClick:C,disabled:!a.value||!r.value},"重置自动映射",8,at),n("button",{onClick:U,disabled:!a.value||!r.value},"生成数据并预览",8,rt),n("button",{onClick:V,disabled:!v.value.length},"下载结果 Excel",8,ut),n("button",{onClick:I,disabled:!v.value.length},"下载 JSON",8,it)]),v.value.length?(c(),i("div",ct,[t[5]||(t[5]=n("h4",null,"输出 JSON（预览，已按公司排序）",-1)),n("textarea",dt,h(D.value),1)])):g("",!0)]))}}),ft=(N,a)=>{const r=N.__vccOpts||N;for(const[m,v]of a)r[m]=v;return r},ht=ft(vt,[["__scopeId","data-v-a4d3cbef"]]);export{ht as default};
