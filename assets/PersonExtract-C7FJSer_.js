import{d as Y,r as S,c as M,o as ee,a as te,b as u,e as n,f as y,g as $,t as m,F as C,h as E,_ as T,i,w as A,j as ne,v as se,k as oe}from"./index-Co1ShIBw.js";const le={class:"person-extract-page"},ae={class:"upload-row"},ue={class:"uploader"},ie={key:0},re={style:{"margin-bottom":"8px"}},ce={class:"detected-columns"},de={key:1,class:"source-preview"},ve={class:"table-scroll"},fe={class:"preview-table"},pe={class:"uploader"},he={key:0},_e={key:0,class:"mapping",style:{"margin-top":"10px"}},me={class:"mapping-table"},ge={class:"multi-select-container"},we=["onClick"],ke={key:0,class:"placeholder"},ye=["onClick"],be={key:0,class:"dropdown-menu"},xe={class:"dropdown-list"},Se=["onClick"],Ce=["checked"],Ee={key:0,class:"dropdown-empty"},je={class:"actions"},Le=["disabled"],Ne=["disabled"],Oe=["disabled"],Re=["disabled"],De={key:1,class:"warning-box"},Me={key:2,class:"output"},Je={rows:"12",style:{width:"98%"}},Ue=Y({__name:"PersonExtract",setup(Xe){const d=S(null),f=S(null),h=S({}),w=S([]),j=S(null),L=S(""),b=S([]),I=M(()=>JSON.stringify(w.value,null,2)),k=M(()=>{if(!d.value||d.value.length===0)return[];const s=new Set;return d.value.forEach(e=>{e&&typeof e=="object"&&Object.keys(e).forEach(t=>s.add(t))}),Array.from(s)}),U=M(()=>{if(!k.value)return[];if(!L.value)return k.value;const s=L.value.toLowerCase();return k.value.filter(e=>e.toLowerCase().includes(s))}),X=M(()=>d.value?d.value.slice(0,5):[]);function F(s){j.value&&(s.target.closest(".multi-select-container")||(j.value=null))}ee(()=>{document.addEventListener("click",F)}),te(()=>{document.removeEventListener("click",F)});function z(s){j.value===s?j.value=null:(j.value=s,L.value="")}function B(s,e){h.value[s]||(h.value[s]=[]);const t=h.value[s].indexOf(e);t>-1?h.value[s].splice(t,1):h.value[s].push(e)}async function P(s){const e=await s.arrayBuffer(),t=await T(()=>import("./xlsx-BvJTHLik.js"),[]),o=t.read(e,{type:"array"});return{XLSX:t,wb:o}}async function q(s){const e=s.target,t=e.files&&e.files[0];if(!t)return;const{XLSX:o,wb:l}=await P(t);let p=[];const a=[];b.value=[];for(const v of l.SheetNames){const c=l.Sheets[v];if(!c)continue;const r=o.utils.sheet_to_json(c,{header:1});let g=-1;for(let _=0;_<Math.min(r.length,20);_++)if((r[_]||[]).map(D=>String(D).trim()).includes("姓名")){g=_;break}if(g===-1){a.push(v);continue}const N=(r[g]||[]).map(_=>String(_).trim()),K=r.slice(g+1).map(_=>{const x={};return N.forEach((D,V)=>{D&&(x[D]=_[V]!==void 0?_[V]:"")}),x.__sheetName=v,x}).filter(_=>Object.values(_).some(x=>x!==""&&x!==v));p=p.concat(K)}a.length>0&&b.value.push(`以下 Sheet 未检测到“姓名”列而被跳过：${a.join(", ")}`),p.length===0&&b.value.push("未在任何 Sheet 中找到包含“姓名”的表头数据"),d.value=p,f.value&&J()}async function H(s){const e=s.target,t=e.files&&e.files[0];if(!t)return;const{XLSX:o,wb:l}=await P(t),p=l.SheetNames[0];if(!p)return;const a=l.Sheets[p];if(!a)return;const v=o.utils.sheet_to_json(a,{header:1});let c;for(const r of v)if(r&&r.some(g=>g!=null&&String(g).trim()!=="")){c=r;break}c?(f.value=c.map(r=>String(r).trim()),d.value&&J()):f.value=[]}function R(s){return s.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").toLowerCase()}function Q(s,e){const t=R(s),o={身份证号码:"身份证号",联系方式:"手机号",联系电话:"手机号",手机号:"手机号","所在部门/公司":"部门",所在部门:"部门",部门:"部门",公司:"公司",姓名:"姓名",性别:"性别",年龄:"年龄",岁数:"年龄",政治面貌:"政治面貌"};if(e.includes(s))return s;if(o[s]){const l=o[s],p=e.find(a=>a===l||a.includes(l));if(p)return p}for(const l of e)if(R(l)===t)return l;for(const l of e)if(R(l).includes(t)||t.includes(R(l)))return l;return null}function J(){if(!d.value||!f.value)return;const s=k.value,e={};for(const t of f.value){const o=Q(t,s);e[t]=o?[o]:[]}h.value=e}function W(){if(w.value=[],b.value=[],!d.value||!f.value)return;const s=k.value.find(a=>a==="公司")||k.value.find(a=>a.includes("公司"));let e=[...d.value];s&&e.sort((a,v)=>{const c=String(a[s]||"").trim(),r=String(v[s]||"").trim();return c.localeCompare(r,"zh-CN")});const t=h.value,o={};e.forEach(a=>{const v=a.__sheetName||"Unknown";o[v]=(o[v]||0)+1});const l={};for(const a of e){const v={},c=a.__sheetName||"Unknown";for(const r of f.value){const g=t[r]||[];let N="";for(const O of g)if(a[O]!==void 0&&a[O]!==""&&a[O]!==null){N=a[O];break}v[r]=N,N||(l[c]||(l[c]={}),l[c][r]=(l[c][r]||0)+1)}w.value.push(v)}const p=[];for(const a in l){const v=o[a],c=[];for(const r in l[a])l[a][r]===v&&c.push(r);c.length>0&&p.push(`Sheet "${a}" 未成功映射字段: ${c.join(", ")}`)}p.length>0&&b.value.push(...p)}async function Z(){if(!w.value.length)return;const s=await T(()=>import("./xlsx-BvJTHLik.js"),[]),e=s.utils.json_to_sheet(w.value,{header:f.value||[]}),t=s.utils.book_new();s.utils.book_append_sheet(t,e,"提取结果"),s.writeFile(t,"人员提取结果.xlsx")}function G(){const s=new Blob([JSON.stringify(w.value,null,2)],{type:"application/json"}),e=URL.createObjectURL(s),t=document.createElement("a");t.href=e,t.download="person-extract.json",t.click(),URL.revokeObjectURL(e)}return(s,e)=>(i(),u("div",le,[e[10]||(e[10]=n("h1",null,"人员提取",-1)),n("div",ae,[n("div",ue,[e[3]||(e[3]=n("h3",null,"1) 上传待提取的 Excel（源表）",-1)),n("input",{type:"file",accept:".xls,.xlsx",onChange:q},null,32),d.value?(i(),u("div",ie,[n("div",re,[e[2]||(e[2]=$("总行数：",-1)),n("strong",null,m(d.value.length),1)]),n("div",ce,[n("div",null,"检测到的列："+m(k.value.join(", ")),1)])])):y("",!0),d.value&&d.value.length?(i(),u("div",de,[n("h4",null,"源表预览（前 "+m(X.value.length)+" 行）",1),n("div",ve,[n("table",fe,[n("thead",null,[n("tr",null,[(i(!0),u(C,null,E(k.value,t=>(i(),u("th",{key:t},m(t),1))),128))])]),n("tbody",null,[(i(!0),u(C,null,E(X.value,(t,o)=>(i(),u("tr",{key:o},[(i(!0),u(C,null,E(k.value,l=>(i(),u("td",{key:l},m(t[l]),1))),128))]))),128))])])])])):y("",!0)]),n("div",pe,[e[4]||(e[4]=n("h3",null,"2) 上传模版 Excel（模板表）",-1)),n("input",{type:"file",accept:".xls,.xlsx",onChange:H},null,32),f.value?(i(),u("div",he," 模版字段："+m(f.value.join(", ")),1)):y("",!0)])]),f.value&&f.value.length?(i(),u("div",_e,[e[7]||(e[7]=n("h4",null,"3) 字段映射确认（支持多选，优先使用靠前的非空值）",-1)),n("table",me,[e[6]||(e[6]=n("thead",null,[n("tr",null,[n("th",{style:{width:"30%"}},"模版字段"),n("th",null,"映射到源表列 (可多选)")])],-1)),n("tbody",null,[(i(!0),u(C,null,E(f.value,t=>(i(),u("tr",{key:t},[n("td",null,m(t),1),n("td",null,[n("div",ge,[n("div",{class:"selected-tags",onClick:o=>z(t)},[!h.value[t]||h.value[t].length===0?(i(),u("span",ke,"点击选择源列...")):y("",!0),(i(!0),u(C,null,E(h.value[t],o=>(i(),u("span",{key:o,class:"tag"},[$(m(o)+" ",1),n("span",{class:"remove-tag",onClick:A(l=>B(t,o),["stop"])},"×",8,ye)]))),128)),e[5]||(e[5]=n("span",{class:"arrow"},"▼",-1))],8,we),j.value===t?(i(),u("div",be,[n("div",{class:"dropdown-search-wrapper",onClick:e[1]||(e[1]=A(()=>{},["stop"]))},[ne(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>L.value=o),class:"dropdown-search-input",placeholder:"搜索列名...",ref_for:!0,ref:o=>{o&&o.focus()}},null,512),[[se,L.value]])]),n("div",xe,[(i(!0),u(C,null,E(U.value,o=>(i(),u("div",{class:"dropdown-item",key:o,onClick:l=>B(t,o)},[n("input",{type:"checkbox",checked:h.value[t]?.includes(o)},null,8,Ce),n("span",null,m(o),1)],8,Se))),128)),U.value.length===0?(i(),u("div",Ee," 无匹配结果 ")):y("",!0)])])):y("",!0)])])]))),128))])])])):y("",!0),n("div",je,[n("button",{onClick:J,disabled:!d.value||!f.value},"重置自动映射",8,Le),n("button",{onClick:W,disabled:!d.value||!f.value},"生成数据并预览",8,Ne),n("button",{onClick:Z,disabled:!w.value.length},"下载结果 Excel",8,Oe),n("button",{onClick:G,disabled:!w.value.length},"下载 JSON",8,Re)]),b.value.length>0?(i(),u("div",De,[e[8]||(e[8]=n("h4",null,"⚠️ 映射警告",-1)),n("ul",null,[(i(!0),u(C,null,E(b.value,(t,o)=>(i(),u("li",{key:o},m(t),1))),128))])])):y("",!0),w.value.length?(i(),u("div",Me,[e[9]||(e[9]=n("h4",null,"输出 JSON（预览，已按公司排序）",-1)),n("textarea",Je,m(I.value),1)])):y("",!0)]))}}),Be=oe(Ue,[["__scopeId","data-v-eec3b430"]]);export{Be as default};
