import{d as Z,r as b,c as O,o as G,a as K,b as a,e as o,f as g,g as P,t as m,F as x,h as S,_ as U,i as u,w as V,j as Y,v as tt,k as et}from"./index-Dtc4kTF_.js";const nt={class:"person-extract-page"},ot={class:"upload-row"},st={class:"uploader"},lt={key:0},at={style:{"margin-bottom":"8px"}},ut={class:"detected-columns"},it={key:1,class:"source-preview"},rt={class:"table-scroll"},ct={class:"preview-table"},dt={class:"uploader"},vt={key:0},ft={key:0,class:"mapping",style:{"margin-top":"10px"}},pt={class:"mapping-table"},_t={class:"multi-select-container"},mt=["onClick"],ht={key:0,class:"placeholder"},wt=["onClick"],gt={key:0,class:"dropdown-menu"},yt={class:"dropdown-list"},kt=["onClick"],bt=["checked"],xt={key:0,class:"dropdown-empty"},St={class:"actions"},Ct=["disabled"],Et=["disabled"],Lt=["disabled"],jt=["disabled"],Nt={key:1,class:"output"},Ot={rows:"12",style:{width:"98%"}},Rt=Z({__name:"PersonExtract",setup(Dt){const i=b(null),r=b(null),v=b({}),h=b([]),k=b(null),C=b(""),T=O(()=>JSON.stringify(h.value,null,2)),w=O(()=>{if(!i.value||i.value.length===0)return[];const n=new Set;return i.value.forEach(t=>{t&&typeof t=="object"&&Object.keys(t).forEach(e=>n.add(e))}),Array.from(n)}),D=O(()=>{if(!w.value)return[];if(!C.value)return w.value;const n=C.value.toLowerCase();return w.value.filter(t=>t.toLowerCase().includes(n))}),J=O(()=>i.value?i.value.slice(0,5):[]);function X(n){k.value&&(n.target.closest(".multi-select-container")||(k.value=null))}G(()=>{document.addEventListener("click",X)}),K(()=>{document.removeEventListener("click",X)});function A(n){k.value===n?k.value=null:(k.value=n,C.value="")}function F(n,t){v.value[n]||(v.value[n]=[]);const e=v.value[n].indexOf(t);e>-1?v.value[n].splice(e,1):v.value[n].push(t)}async function M(n){const t=await n.arrayBuffer(),e=await U(()=>import("./xlsx-BvJTHLik.js"),[]),s=e.read(t,{type:"array"});return{XLSX:e,wb:s}}async function I(n){const t=n.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:s,wb:l}=await M(e);let c=[];for(const f of l.SheetNames){const y=l.Sheets[f];if(!y)continue;const d=s.utils.sheet_to_json(y,{header:1});let _=-1;for(let p=0;p<Math.min(d.length,20);p++)if((d[p]||[]).map(N=>String(N).trim()).includes("姓名")){_=p;break}if(_===-1)continue;const E=(d[_]||[]).map(p=>String(p).trim()),W=d.slice(_+1).map(p=>{const L={};return E.forEach((N,B)=>{N&&(L[N]=p[B]!==void 0?p[B]:"")}),L}).filter(p=>Object.values(p).some(L=>L!==""));c=c.concat(W)}c.length===0&&alert("未在任何 Sheet 中找到包含“姓名”的表头数据"),i.value=c,r.value&&R()}async function z(n){const t=n.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:s,wb:l}=await M(e),c=l.SheetNames[0];if(!c)return;const f=l.Sheets[c];if(!f)return;const y=s.utils.sheet_to_json(f,{header:1});let d;for(const _ of y)if(_&&_.some(E=>E!=null&&String(E).trim()!=="")){d=_;break}d?(r.value=d.map(_=>String(_).trim()),i.value&&R()):r.value=[]}function j(n){return n.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").toLowerCase()}function $(n,t){const e=j(n),s={身份证号码:"身份证号",联系方式:"手机号",联系电话:"手机号",手机号:"手机号","所在部门/公司":"部门",所在部门:"部门",部门:"部门",公司:"公司",姓名:"姓名",性别:"性别",年龄:"年龄",岁数:"年龄",政治面貌:"政治面貌"};if(t.includes(n))return n;if(s[n]){const l=s[n],c=t.find(f=>f===l||f.includes(l));if(c)return c}for(const l of t)if(j(l)===e)return l;for(const l of t)if(j(l).includes(e)||e.includes(j(l)))return l;return null}function R(){if(!i.value||!r.value)return;const n=w.value,t={};for(const e of r.value){const s=$(e,n);t[e]=s?[s]:[]}v.value=t}function q(){if(h.value=[],!i.value||!r.value)return;const n=w.value.find(s=>s==="公司")||w.value.find(s=>s.includes("公司"));let t=[...i.value];n&&t.sort((s,l)=>{const c=String(s[n]||"").trim(),f=String(l[n]||"").trim();return c.localeCompare(f,"zh-CN")});const e=v.value;for(const s of t){const l={};for(const c of r.value){const f=e[c]||[];let y="";for(const d of f)if(s[d]!==void 0&&s[d]!==""&&s[d]!==null){y=s[d];break}l[c]=y}h.value.push(l)}}async function H(){if(!h.value.length)return;const n=await U(()=>import("./xlsx-BvJTHLik.js"),[]),t=n.utils.json_to_sheet(h.value,{header:r.value||[]}),e=n.utils.book_new();n.utils.book_append_sheet(e,t,"提取结果"),n.writeFile(e,"人员提取结果.xlsx")}function Q(){const n=new Blob([JSON.stringify(h.value,null,2)],{type:"application/json"}),t=URL.createObjectURL(n),e=document.createElement("a");e.href=t,e.download="person-extract.json",e.click(),URL.revokeObjectURL(t)}return(n,t)=>(u(),a("div",nt,[t[9]||(t[9]=o("h1",null,"人员提取",-1)),o("div",ot,[o("div",st,[t[3]||(t[3]=o("h3",null,"1) 上传待提取的 Excel（源表）",-1)),o("input",{type:"file",accept:".xls,.xlsx",onChange:I},null,32),i.value?(u(),a("div",lt,[o("div",at,[t[2]||(t[2]=P("总行数：",-1)),o("strong",null,m(i.value.length),1)]),o("div",ut,[o("div",null,"检测到的列："+m(w.value.join(", ")),1)])])):g("",!0),i.value&&i.value.length?(u(),a("div",it,[o("h4",null,"源表预览（前 "+m(J.value.length)+" 行）",1),o("div",rt,[o("table",ct,[o("thead",null,[o("tr",null,[(u(!0),a(x,null,S(w.value,e=>(u(),a("th",{key:e},m(e),1))),128))])]),o("tbody",null,[(u(!0),a(x,null,S(J.value,(e,s)=>(u(),a("tr",{key:s},[(u(!0),a(x,null,S(w.value,l=>(u(),a("td",{key:l},m(e[l]),1))),128))]))),128))])])])])):g("",!0)]),o("div",dt,[t[4]||(t[4]=o("h3",null,"2) 上传模版 Excel（模板表）",-1)),o("input",{type:"file",accept:".xls,.xlsx",onChange:z},null,32),r.value?(u(),a("div",vt," 模版字段："+m(r.value.join(", ")),1)):g("",!0)])]),r.value&&r.value.length?(u(),a("div",ft,[t[7]||(t[7]=o("h4",null,"3) 字段映射确认（支持多选，优先使用靠前的非空值）",-1)),o("table",pt,[t[6]||(t[6]=o("thead",null,[o("tr",null,[o("th",{style:{width:"30%"}},"模版字段"),o("th",null,"映射到源表列 (可多选)")])],-1)),o("tbody",null,[(u(!0),a(x,null,S(r.value,e=>(u(),a("tr",{key:e},[o("td",null,m(e),1),o("td",null,[o("div",_t,[o("div",{class:"selected-tags",onClick:s=>A(e)},[!v.value[e]||v.value[e].length===0?(u(),a("span",ht,"点击选择源列...")):g("",!0),(u(!0),a(x,null,S(v.value[e],s=>(u(),a("span",{key:s,class:"tag"},[P(m(s)+" ",1),o("span",{class:"remove-tag",onClick:V(l=>F(e,s),["stop"])},"×",8,wt)]))),128)),t[5]||(t[5]=o("span",{class:"arrow"},"▼",-1))],8,mt),k.value===e?(u(),a("div",gt,[o("div",{class:"dropdown-search-wrapper",onClick:t[1]||(t[1]=V(()=>{},["stop"]))},[Y(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>C.value=s),class:"dropdown-search-input",placeholder:"搜索列名...",ref_for:!0,ref:s=>{s&&s.focus()}},null,512),[[tt,C.value]])]),o("div",yt,[(u(!0),a(x,null,S(D.value,s=>(u(),a("div",{class:"dropdown-item",key:s,onClick:l=>F(e,s)},[o("input",{type:"checkbox",checked:v.value[e]?.includes(s)},null,8,bt),o("span",null,m(s),1)],8,kt))),128)),D.value.length===0?(u(),a("div",xt," 无匹配结果 ")):g("",!0)])])):g("",!0)])])]))),128))])])])):g("",!0),o("div",St,[o("button",{onClick:R,disabled:!i.value||!r.value},"重置自动映射",8,Ct),o("button",{onClick:q,disabled:!i.value||!r.value},"生成数据并预览",8,Et),o("button",{onClick:H,disabled:!h.value.length},"下载结果 Excel",8,Lt),o("button",{onClick:Q,disabled:!h.value.length},"下载 JSON",8,jt)]),h.value.length?(u(),a("div",Nt,[t[8]||(t[8]=o("h4",null,"输出 JSON（预览，已按公司排序）",-1)),o("textarea",Ot,m(T.value),1)])):g("",!0)]))}}),Ft=et(Rt,[["__scopeId","data-v-c57b8ca3"]]);export{Ft as default};
