import{d as z,r as L,c as N,a as u,b as n,k as b,t as h,F as g,f as y,_ as J,h as i,w as A,l as T}from"./index-B771QOqE.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"person-extract-page"},Z={class:"upload-row"},q={class:"uploader"},G={key:0},K={key:1,class:"source-preview"},Q={class:"table-scroll"},Y={class:"preview-table"},$={class:"uploader"},tt={key:0},et={key:0,class:"mapping"},nt={class:"mapping-table"},ot=["onUpdate:modelValue"],st=["value"],lt={class:"actions"},at=["disabled"],rt=["disabled"],ut=["disabled"],it=["disabled"],ct={key:1,class:"output"},dt={rows:"12",style:{width:"100%"}},vt=z({__name:"PersonExtract",setup(ft){const r=L(null),c=L(null),k=L({}),f=L([]),X=N(()=>JSON.stringify(f.value,null,2)),m=N(()=>!r.value||r.value.length===0?[]:Object.keys(r.value[0])),j=N(()=>r.value?r.value.slice(0,5):[]);async function R(s){const t=await s.arrayBuffer(),e=await J(()=>import("./xlsx-BvJTHLik.js"),[]),o=e.read(t,{type:"array"}),l=o.SheetNames[0];if(!l)throw alert("Excel 文件为空或无法读取"),new Error("No sheets found");const a=o.Sheets[l];if(!a)throw new Error("Sheet content is empty");return{XLSX:e,wb:o,ws:a}}async function D(s){const t=s.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:o,wb:l}=await R(e);let a=[];for(const d of l.SheetNames){const p=l.Sheets[d];if(!p)continue;const _=o.utils.sheet_to_json(p,{header:1});let x=-1;for(let v=0;v<Math.min(_.length,20);v++)if((_[v]||[]).map(E=>String(E).trim()).includes("姓名")){x=v;break}if(x===-1)continue;const I=(_[x]||[]).map(v=>String(v).trim()),M=_.slice(x+1).map(v=>{const w={};return I.forEach((E,O)=>{E&&(w[E]=v[O]!==void 0?v[O]:"")}),w}).filter(v=>Object.values(v).some(w=>w!==""));a=a.concat(M)}a.length===0&&alert("未在任何 Sheet 中找到包含“姓名”的表头数据"),r.value=a}async function F(s){const t=s.target,e=t.files&&t.files[0];if(!e)return;const{XLSX:o,ws:l}=await R(e),a=o.utils.sheet_to_json(l,{header:1});let d;for(const p of a)if(p&&p.some(_=>_!=null&&String(_).trim()!=="")){d=p;break}d?(c.value=d.map(p=>String(p).trim()),r.value&&C()):c.value=[]}function S(s){return s.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"").toLowerCase()}function B(s,t){const e=S(s),o={身份证号码:"身份证号",联系方式:"手机号",联系电话:"手机号",手机号:"手机号","所在部门/公司":"部门",所在部门:"部门",部门:"部门",公司:"公司",姓名:"姓名",性别:"性别",年龄:"年龄(岁)",政治面貌:"政治面貌"};if(t.includes(s))return s;if(o[s]){const l=o[s],a=t.find(d=>d===l||d.includes(l));if(a)return a}for(const l of t)if(S(l)===e)return l;for(const l of t)if(S(l).includes(e)||e.includes(S(l)))return l;return""}function C(){if(!r.value||!c.value)return;const s=m.value,t={};for(const e of c.value){const o=B(e,s);t[e]=o||""}k.value=t}function P(){if(f.value=[],!r.value||!c.value)return;const s=m.value.find(o=>o==="公司")||m.value.find(o=>o.includes("公司"));let t=[...r.value];s&&t.sort((o,l)=>{const a=String(o[s]||"").trim(),d=String(l[s]||"").trim();return a.localeCompare(d,"zh-CN")});const e=k.value;for(const o of t){const l={};for(const a of c.value){const d=e[a];l[a]=d?o[d]??"":""}f.value.push(l)}}async function U(){if(!f.value.length)return;const s=await J(()=>import("./xlsx-BvJTHLik.js"),[]),t=s.utils.json_to_sheet(f.value,{header:c.value||[]}),e=s.utils.book_new();s.utils.book_append_sheet(e,t,"提取结果"),s.writeFile(e,"人员提取结果.xlsx")}function V(){const s=new Blob([JSON.stringify(f.value,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),e=document.createElement("a");e.href=t,e.download="person-extract.json",e.click(),URL.revokeObjectURL(t)}return(s,t)=>(i(),u("div",W,[t[6]||(t[6]=n("h1",null,"人员提取",-1)),n("div",Z,[n("div",q,[t[0]||(t[0]=n("h3",null,"1) 上传待提取的 Excel（源表）",-1)),n("input",{type:"file",accept:".xls,.xlsx",onChange:D},null,32),r.value?(i(),u("div",G," 行数："+h(r.value.length),1)):b("",!0),r.value&&r.value.length?(i(),u("div",K,[n("h4",null,"源表预览（前 "+h(j.value.length)+" 行）",1),n("div",Q,[n("table",Y,[n("thead",null,[n("tr",null,[(i(!0),u(g,null,y(m.value,e=>(i(),u("th",{key:e},h(e),1))),128))])]),n("tbody",null,[(i(!0),u(g,null,y(j.value,(e,o)=>(i(),u("tr",{key:o},[(i(!0),u(g,null,y(m.value,l=>(i(),u("td",{key:l},h(e[l]),1))),128))]))),128))])])])])):b("",!0)]),n("div",$,[t[1]||(t[1]=n("h3",null,"2) 上传模版 Excel（模板表）",-1)),n("input",{type:"file",accept:".xls,.xlsx",onChange:F},null,32),c.value?(i(),u("div",tt," 模版字段："+h(c.value.join(", ")),1)):b("",!0)])]),c.value&&c.value.length?(i(),u("div",et,[t[4]||(t[4]=n("h4",null,"3) 字段映射确认（可手动修改）",-1)),n("table",nt,[t[3]||(t[3]=n("thead",null,[n("tr",null,[n("th",null,"模版字段"),n("th",null,"映射到源表列")])],-1)),n("tbody",null,[(i(!0),u(g,null,y(c.value,e=>(i(),u("tr",{key:e},[n("td",null,h(e),1),n("td",null,[A(n("select",{"onUpdate:modelValue":o=>k.value[e]=o},[t[2]||(t[2]=n("option",{value:""},"(请选择源表列)",-1)),(i(!0),u(g,null,y(m.value,o=>(i(),u("option",{key:o,value:o},h(o),9,st))),128))],8,ot),[[T,k.value[e]]])])]))),128))])])])):b("",!0),n("div",lt,[n("button",{onClick:C,disabled:!r.value||!c.value},"重置自动映射",8,at),n("button",{onClick:P,disabled:!r.value||!c.value},"生成数据并预览",8,rt),n("button",{onClick:U,disabled:!f.value.length},"下载结果 Excel",8,ut),n("button",{onClick:V,disabled:!f.value.length},"下载 JSON",8,it)]),f.value.length?(i(),u("div",ct,[t[5]||(t[5]=n("h4",null,"输出 JSON（预览，已按公司排序）",-1)),n("textarea",dt,h(X.value),1)])):b("",!0)]))}}),mt=H(vt,[["__scopeId","data-v-a4d3cbef"]]);export{mt as default};
